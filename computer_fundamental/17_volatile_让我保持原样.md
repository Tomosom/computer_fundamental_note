- 嵌入式开发中的常见情形

    ![](_v_images_17/1.png)
    ![](_v_images_17/2.png)

# 实验 - 设备启动及初始化


- 问题分析
    - 编译优化时, 编译器根据当前文件进行优化
    - 编译器能够发现变量 "不可能" 被改变 (const 全局变量)
    - 为了效率上的提高, 编译将变量值进行缓存
    - 缓存的方式为 : 把变量值从内存中读取进入寄存器
    - 每次访问变量时直接从寄存器读取对应值

- 解决方案
    - 使用 volatile 修饰可能被 "意外" 修改的变量 (内存)
        - volatile 修饰的变量是一种 "易变的" 变量
        - volatile 可理解为 "编译器警告指示字"
        - volatile 告诉编译器必须每次去内存中取变量值

# 实验 - 使用 volatile 修饰变量

- 问题
    - 如何理解 const 和 volatile 同时修饰变量 ? 在语义上是否矛盾 ?

- const 和 volatile
    - const 表示被修饰的变量不能出现在赋值符号左边
    - volatile 表示使用变量时直接从内存取值
    - const 和 volatile 同时修饰变量时互不影响其含义

    ![](_v_images_17/3.png)

# 小结
- 编译优化时, 编译器只根据当前文件进行优化
- 编译器的优化策略可能造成一些 "意外"
- volatile 强制编译器必须每次从内存中取变量值
- const 和 volatile 同时修饰变量时互不影响其含义
